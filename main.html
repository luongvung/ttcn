<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="styles.css" />
    <title>3D Model</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      function load_prog(load_status, load_session) {
        var loaded = 0;
        var total = 0;

        //go over all models that are/were loaded
        Object.keys(load_status).forEach(function (model_id) {
          if (load_status[model_id].load_session == load_session) {
            //need to make sure we're on the last loading session (not counting previous loaded models)
            loaded += load_status[model_id].loaded;
            total += load_status[model_id].total;

            //set the relevant model's progress bar
          }
        });

        //set total progress bar
        document.getElementById("pbar").value = loaded / total;
      }
    </script>
  </head>
  <body>
    <div class="container">
      <div class="function-table">
        <div>
          <label>Background color:</label>
          <input
            type="color"
            value="#FFFFFF"
            id="background-color"
            name="background-color"
          />
        </div>

        <div>
          <label>Model color:</label>
          <input
            type="color"
            value="#FFFFFF"
            id="model-color"
            name="model-color"
          />
        </div>

        <div>
          <label>Opacity</label>
          <input type="range" min="0" max="100" value="100" id="opacity" />
        </div>

        <div>
          <label>Display:</label>
          <select id="displaySelect">
            <option value="flat" selected>Flat</option>
            <option value="smooth">Smooth</option>
            <option value="wireframe">Wireframe</option>
          </select>
        </div>
      </div>
      <div class="model-viewer">
        <div class="model-new hidden">ssss</div>
        <div class="text-overlay"></div>
        <progress id="pbar" value="0" max="1"></progress>
      </div>
    </div>

    <script src="stl_viewer.js"></script>

    <script>
      let modelID = 1;
      let stl_viewer = new StlViewer(document.querySelector(".model-viewer"), {
        on_model_mousedown: model_clicked,
        loading_progress_callback: load_prog,
      });

      function model_clicked(model_id) {
        stl_viewer.set_edges(modelID, false);
        modelID = model_id;
        console.log(modelID);
        stl_viewer.set_edges(modelID, true);
        textOverlayEl.textContent = `file name: ${stl_viewer.get_model_info(
          modelID
        )}`;
      }

      // stl_viewer.add_model({ id: 1, filename: "Bone_Dragon[30].stl" });
      // stl_viewer.add_model({ id: 2, filename: "eyeball.stl", x: 3 });

      const backgroundColorEl = document.getElementById("background-color");
      const modelColorEl = document.getElementById("model-color");
      const opacityEl = document.getElementById("opacity");
      const displaySelect = document.getElementById("displaySelect");
      const textOverlayEl = document.querySelector(".text-overlay");

      backgroundColorEl.addEventListener("input", function () {
        stl_viewer.set_bg_color(backgroundColorEl.value);
      });

      modelColorEl.addEventListener("input", function () {
        stl_viewer.set_color(modelID, modelColorEl.value);
      });

      opacityEl.addEventListener("input", () => {
        stl_viewer.set_opacity(modelID, opacityEl.value / 100);
      });

      displaySelect.addEventListener("change", function () {
        const selectedValue = displaySelect.value;
        stl_viewer.set_display(modelID, selectedValue);
        stl_viewer.set_on_model_mouseclick(log);
      });
    </script>
  </body>
</html>

<!-- <!DOCTYPE html>
<html>
  <head>
    <title>Viewstl Javascript Plugin - User file</title>
  </head>

  <style>
    body {
      text-align: center;
    }
  </style>

  <script></script>

  <body>
    <div
      id="stl_cont"
      style="
        width: 1200px;
        height: 600px;
        margin: 0 auto;
        border: 2px solid #000;
      "
    >
      ssssssssssssssssssssssssss
    </div>
    <button id="remove">Remove</button>
    <div class="slider-container">
      <input
        type="range"
        min="0"
        max="100"
        value="100"
        class="slider"
        id="mySlider"
      />
      <p>Value: <span id="sliderValue">50</span></p>
    </div>
    <input
      id="color3"
      type="color"
      value="#FAFEAB"
      onchange="$id('transparent3').checked=false;stl_viewer.set_color(, this.value);"
    />
    <script src="stl_viewer.min.js"></script>

    <script>
      var stl_viewer = new StlViewer(document.getElementById("stl_cont"), {});
      var removeBtn = document.getElementById("remove");

      const slider = document.getElementById("mySlider");
      const sliderValueDisplay = document.getElementById("sliderValue");

      stl_viewer.add_model({ id: 1, filename: "test.stl" });

      function yeh_mouse_down() {
        console.log("ok");
      }
      setTimeout(() => {
        stl_viewer.set_on_model_mousedown(yeh_mouse_down);
      }, 2000);

      slider.addEventListener("input", () => {
        const sliderValue = slider.value;
        stl_viewer.set_opacity(1, sliderValue / 100);
      });

      removeBtn.addEventListener("click", function () {
        stl_viewer.set_opacity(1, 0.5);
      });
    </script>

    <input type="file" onchange='stl_viewer.add_model({local_file:this.files[0]});' accept="*.*">
  </body>
</html> -->
